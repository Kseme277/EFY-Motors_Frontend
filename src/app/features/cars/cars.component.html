<app-header></app-header>

<!-- Loader -->
<div id="ftco-loader" class="fullscreen" [class.show]="isLoading" [class.hidden]="!isLoading">
  <svg class="circular" width="48px" height="48px">
    <circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/>
    <circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#005F9B"/>
  </svg>
</div>

<section class="hero-wrap hero-wrap-2 js-fullheight" style="background-image: url('assets/images/vehicule.jpg');" data-stellar-background-ratio="0.5">
  <div class="overlay"></div>
  <div class="container">
    <div class="row no-gutters slider-text js-fullheight align-items-end justify-content-start">
      <div class="col-md-9 ftco-animate pb-5">
        <p class="breadcrumbs"><span class="mr-2"><a routerLink="/">Accueil <i class="ion-ios-arrow-forward"></i></a></span> <span>Véhicules <i class="ion-ios-arrow-forward"></i></span></p>
        <h1 class="mb-3 bread">Choisissez Votre Voiture</h1>
      </div>
    </div>
  </div>
</section>

<section class="ftco-section bg-light cars-section" *ngIf="!isLoading">
  <div class="container-fluid px-3 px-md-4">
    <div class="row g-3">
      <!-- Filtres à gauche -->
      <div class="col-md-3 mb-4">
        <div class="filter-panel bg-white p-4 rounded shadow-sm">
          <h3 class="mb-4">Filtres</h3>
          
          <!-- Marques -->
          <div class="filter-group mb-4">
            <h5 class="mb-3">Marques</h5>
            <div class="form-check mb-2" *ngFor="let brand of brands">
              <input class="form-check-input" type="checkbox" [id]="'brand-' + brand" [checked]="selectedBrands.includes(brand)" (change)="toggleBrand(brand)">
              <label class="form-check-label" [for]="'brand-' + brand">
                {{ brand }}
              </label>
            </div>
          </div>

          <!-- Kilométrage -->
          <div class="filter-group mb-4">
            <h5 class="mb-3">Kilométrage maximum</h5>
            <input type="range" class="form-range" min="0" [max]="maxAvailableMileage" step="5000" [(ngModel)]="maxMileage" (input)="onMileageChange()">
            <div class="d-flex justify-content-between">
              <small>0 km</small>
              <small>{{ maxMileage | number }} km</small>
              <small>{{ maxAvailableMileage | number }} km</small>
            </div>
          </div>

          <!-- Transmission -->
          <div class="filter-group mb-4">
            <h5 class="mb-3">Transmission</h5>
            <div class="form-check mb-2" *ngFor="let transmission of transmissions">
              <input class="form-check-input" type="checkbox" [id]="'transmission-' + transmission" [checked]="selectedTransmissions.includes(transmission)" (change)="toggleTransmission(transmission)">
              <label class="form-check-label" [for]="'transmission-' + transmission">
                {{ transmission }}
              </label>
            </div>
          </div>

          <!-- Sièges -->
          <div class="filter-group mb-4">
            <h5 class="mb-3">Nombre de sièges</h5>
            <select class="form-select" [(ngModel)]="selectedSeats" (change)="onSeatsChange()">
              <option [value]="null">Tous</option>
              <option [value]="seat" *ngFor="let seat of seats">{{ seat }} sièges</option>
            </select>
          </div>

          <!-- Bagages -->
          <div class="filter-group mb-4">
            <h5 class="mb-3">Capacité bagages</h5>
            <select class="form-select" [(ngModel)]="selectedLuggage" (change)="onLuggageChange()">
              <option [value]="null">Tous</option>
              <option [value]="lug" *ngFor="let lug of luggage">{{ lug }} valise(s)</option>
            </select>
          </div>

          <!-- Carburant -->
          <div class="filter-group mb-4">
            <h5 class="mb-3">Type de carburant</h5>
            <div class="form-check mb-2" *ngFor="let fuel of fuels">
              <input class="form-check-input" type="checkbox" [id]="'fuel-' + fuel" [checked]="selectedFuels.includes(fuel)" (change)="toggleFuel(fuel)">
              <label class="form-check-label" [for]="'fuel-' + fuel">
                {{ fuel }}
              </label>
            </div>
          </div>

          <!-- Bouton réinitialiser -->
          <button class="btn btn-secondary w-100" (click)="resetFilters()">Réinitialiser les filtres</button>
        </div>
      </div>

      <!-- Liste des voitures à droite -->
      <div class="col-md-9">
        <!-- Message de chargement -->
        <div *ngIf="isLoading" class="text-center py-5">
          <div class="spinner-border text-primary" role="status" style="color: #005F9B !important;">
            <span class="sr-only">Chargement...</span>
          </div>
          <p class="mt-3">Chargement des véhicules...</p>
        </div>
        
        <!-- Message si aucun résultat -->
        <div *ngIf="!isLoading && cars.length === 0" class="text-center py-5">
          <p class="text-muted">Aucun véhicule ne correspond à vos critères de recherche.</p>
        </div>
        
        <div class="cars-grid" *ngIf="!isLoading && displayedCars.length > 0">
          <div class="car-card" *ngFor="let car of displayedCars">
            <div class="car-image">
              <img [src]="car.image" [alt]="car.name">
              <div class="car-badge">{{car.brand}}</div>
            </div>
            <div class="car-content">
              <h3 class="car-title">{{car.name}}</h3>
              <p class="car-description">Véhicule {{car.transmission.toLowerCase()}} avec {{car.seats}} places, idéal pour vos déplacements.</p>
              <div class="car-rating">
                <div class="stars">
                  <span class="star filled" *ngFor="let i of [1,2,3,4,5]">★</span>
                </div>
                <span class="rating-value">4.5</span>
                <span class="reviews">({{car.reviews?.length || 0}} avis)</span>
              </div>
              <div class="car-footer">
                <div class="car-price">
                  <span class="price-label">Prix</span>
                  <span class="price-value">{{car.price | number}} FCFA</span>
                </div>
                <a [routerLink]="['/cars', car.id]" class="btn-view-details">Voir détails</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Pagination -->
    <div class="row mt-5" *ngIf="!isLoading && cars.length > 0">
      <div class="col text-center">
        <div class="block-27">
          <ul>
            <li><a (click)="previousPage()" [class.disabled]="currentPage === 1" style="cursor: pointer;">&lt;</a></li>
            <li *ngFor="let page of getPageNumbers()" [class.active]="page === currentPage">
              <a *ngIf="page !== currentPage" (click)="goToPage(page)" style="cursor: pointer;">{{ page }}</a>
              <span *ngIf="page === currentPage">{{ page }}</span>
            </li>
            <li><a (click)="nextPage()" [class.disabled]="currentPage === totalPages" style="cursor: pointer;">&gt;</a></li>
          </ul>
        </div>
        <p class="mt-3 text-muted">Page {{ currentPage }} sur {{ totalPages }} ({{ cars.length }} véhicule(s))</p>
      </div>
    </div>
  </div>
</section>

<app-footer></app-footer>

